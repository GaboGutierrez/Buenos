CREATE DATABASE [Escuela]
 CONTAINMENT = NONE
 ON  PRIMARY 
( NAME = N'Escuela', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\Escuela.mdf' , SIZE = 5120KB , MAXSIZE = UNLIMITED, FILEGROWTH = 1024KB )
 LOG ON 
( NAME = N'Escuela_log', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\Escuela_log.ldf' , SIZE = 1024KB , MAXSIZE = 2048GB , FILEGROWTH = 10%)
GO
ALTER DATABASE [Escuela] SET COMPATIBILITY_LEVEL = 110
GO
IF (1 = FULLTEXTSERVICEPROPERTY('IsFullTextInstalled'))
begin
EXEC [Escuela].[dbo].[sp_fulltext_database] @action = 'enable'
end
GO
ALTER DATABASE [Escuela] SET ANSI_NULL_DEFAULT OFF 
GO
ALTER DATABASE [Escuela] SET ANSI_NULLS OFF 
GO
ALTER DATABASE [Escuela] SET ANSI_PADDING OFF 
GO
ALTER DATABASE [Escuela] SET ANSI_WARNINGS OFF 
GO
ALTER DATABASE [Escuela] SET ARITHABORT OFF 
GO
ALTER DATABASE [Escuela] SET AUTO_CLOSE OFF 
GO
ALTER DATABASE [Escuela] SET AUTO_CREATE_STATISTICS ON 
GO
ALTER DATABASE [Escuela] SET AUTO_SHRINK OFF 
GO
ALTER DATABASE [Escuela] SET AUTO_UPDATE_STATISTICS ON 
GO
ALTER DATABASE [Escuela] SET CURSOR_CLOSE_ON_COMMIT OFF 
GO
ALTER DATABASE [Escuela] SET CURSOR_DEFAULT  GLOBAL 
GO
ALTER DATABASE [Escuela] SET CONCAT_NULL_YIELDS_NULL OFF 
GO
ALTER DATABASE [Escuela] SET NUMERIC_ROUNDABORT OFF 
GO
ALTER DATABASE [Escuela] SET QUOTED_IDENTIFIER OFF 
GO
ALTER DATABASE [Escuela] SET RECURSIVE_TRIGGERS OFF 
GO
ALTER DATABASE [Escuela] SET  DISABLE_BROKER 
GO
ALTER DATABASE [Escuela] SET AUTO_UPDATE_STATISTICS_ASYNC OFF 
GO
ALTER DATABASE [Escuela] SET DATE_CORRELATION_OPTIMIZATION OFF 
GO
ALTER DATABASE [Escuela] SET TRUSTWORTHY OFF 
GO
ALTER DATABASE [Escuela] SET ALLOW_SNAPSHOT_ISOLATION OFF 
GO
ALTER DATABASE [Escuela] SET PARAMETERIZATION SIMPLE 
GO
ALTER DATABASE [Escuela] SET READ_COMMITTED_SNAPSHOT OFF 
GO
ALTER DATABASE [Escuela] SET HONOR_BROKER_PRIORITY OFF 
GO
ALTER DATABASE [Escuela] SET RECOVERY FULL 
GO
ALTER DATABASE [Escuela] SET  MULTI_USER 
GO
ALTER DATABASE [Escuela] SET PAGE_VERIFY CHECKSUM  
GO
ALTER DATABASE [Escuela] SET DB_CHAINING OFF 
GO
ALTER DATABASE [Escuela] SET FILESTREAM( NON_TRANSACTED_ACCESS = OFF ) 
GO
ALTER DATABASE [Escuela] SET TARGET_RECOVERY_TIME = 0 SECONDS 
GO
EXEC sys.sp_db_vardecimal_storage_format N'Escuela', N'ON'
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- exec spMostrarAlumno
CREATE PROCEDURE [spMostrarAlumno]
AS
    BEGIN	
        SELECT  ALUM_ID ,
                ALUM_NOMB ,
                ALUM_APAT ,
                ALUM_AMAT ,
                ALUM_FNAC ,
                ALUM_SEXO_ID ,
				SEXO_ID,
				SEXO_NOMB,
				ALUM_FREG ,
                ALLUM_MAIL ,
                ALUM_PRGR ,
                ALUM_MATR ,
                ALUM_EXPS_ID ,
				EXPS_ID,
				EXPS_RESP_UNO, 
				EXPS_RESP_DOS, 
				EXPS_RESP_TRES, 
				EXPS_RESP_CUAT, 
				EXPS_FECH_APLI, 
				EXPS_ESTA,
                ALUM_ETAP_ID ,
				ETAP_ID,  
				ETAP_NOMB, 
				ETAP_DESC,
                ALUM_PERF_ID ,
				PERF_ID, 
				PERF_NOMB,
                ALUM_PASS
        FROM    dbo.ALUMNO
                INNER JOIN dbo.SEXO ON SEXO.SEXO_ID = ALUMNO.ALUM_SEXO_ID
                INNER JOIN dbo.EXAMEN_PSICOMETRICO ON EXAMEN_PSICOMETRICO.EXPS_ID = ALUMNO.ALUM_EXPS_ID
                INNER JOIN dbo.ETAPAS ON ETAPAS.ETAP_ID = ALUMNO.ALUM_ETAP_ID
                INNER JOIN dbo.PERFIL ON PERFIL.PERF_ID = ALUMNO.ALUM_PERF_ID;
    END;
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [ALUMNO](
	[ALUM_ID] [int] NOT NULL,
	[ALUM_NOMB] [nvarchar](30) NOT NULL,
	[ALUM_APAT] [nvarchar](30) NOT NULL,
	[ALUM_AMAT] [nvarchar](30) NULL,
	[ALUM_FNAC] [date] NOT NULL,
	[ALUM_SEXO_ID] [int] NOT NULL,
	[ALUM_FREG] [date] NULL,
	[ALLUM_MAIL] [nvarchar](max) NULL,
	[ALUM_PRGR] [decimal](5, 2) NULL,
	[ALUM_MATR] [nvarchar](30) NULL,
	[ALUM_EXPS_ID] [int] NULL,
	[ALUM_ETAP_ID] [int] NULL,
	[ALUM_PERF_ID] [int] NULL,
	[ALUM_PASS] [nvarchar](50) NULL,
 CONSTRAINT [PK_ALUMNO] PRIMARY KEY CLUSTERED 
(
	[ALUM_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [DOCUMENTOS](
	[DOCS_ID] [int] NOT NULL,
	[DOCS_ALUM_ID] [int] NOT NULL,
	[DOCS_NOMB] [nvarchar](50) NOT NULL,
	[DOCS_TIPO] [nvarchar](30) NOT NULL,
	[DOCS_APRO] [bit] NOT NULL,
	[DOCS_FECH_ALTA] [date] NOT NULL,
 CONSTRAINT [PK_DOCUMENTOS] PRIMARY KEY CLUSTERED 
(
	[DOCS_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [ETAPAS](
	[ETAP_ID] [int] NOT NULL,
	[ETAP_NOMB] [nvarchar](50) NOT NULL,
	[ETAP_DESC] [nvarchar](max) NULL,
 CONSTRAINT [PK_ETAPAS] PRIMARY KEY CLUSTERED 
(
	[ETAP_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [EXAMEN](
	[EXAM_ID] [int] NOT NULL,
	[EXAM_ALUM_ID] [int] NOT NULL,
	[EXAM_RESP_UNO] [nvarchar](max) NOT NULL,
	[EXAM_RESP_DOS] [decimal](12, 2) NOT NULL,
	[EXAM_RESP_TRES] [bit] NOT NULL,
	[EXAM_RESP_CUAT] [datetime] NOT NULL,
	[EXAM_FECH_APLI] [date] NOT NULL,
	[EXAM_CALI] [decimal](5, 2) NOT NULL,
	[EXAM_APRO] [bit] NOT NULL,
 CONSTRAINT [PK_EXAMEN] PRIMARY KEY CLUSTERED 
(
	[EXAM_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [EXAMEN_PSICOMETRICO](
	[EXPS_ID] [int] NOT NULL,
	[EXPS_RESP_UNO] [int] NOT NULL,
	[EXPS_RESP_DOS] [int] NOT NULL,
	[EXPS_RESP_TRES] [int] NOT NULL,
	[EXPS_RESP_CUAT] [int] NOT NULL,
	[EXPS_FECH_APLI] [date] NOT NULL,
	[EXPS_ESTA] [bit] NOT NULL,
 CONSTRAINT [PK_EXAMEN_PSICOMETRICO] PRIMARY KEY CLUSTERED 
(
	[EXPS_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [PAGOS](
	[PAGO_ID] [int] NOT NULL,
	[PAGO_ALUM_ID] [int] NOT NULL,
	[PAGO_FECH] [date] NOT NULL,
	[PAGO_CANT] [decimal](10, 2) NOT NULL,
	[PAGO_DESC] [nvarchar](max) NOT NULL,
	[PAGO_TIPO_PAGO_ID] [int] NOT NULL,
 CONSTRAINT [PK_PAGOS] PRIMARY KEY CLUSTERED 
(
	[PAGO_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [PERFIL](
	[PERF_ID] [int] NOT NULL,
	[PERF_NOMB] [nvarchar](30) NOT NULL,
 CONSTRAINT [PK_PERFIL] PRIMARY KEY CLUSTERED 
(
	[PERF_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [SEXO](
	[SEXO_ID] [int] NOT NULL,
	[SEXO_NOMB] [nvarchar](30) NOT NULL,
 CONSTRAINT [PK_SEXO] PRIMARY KEY CLUSTERED 
(
	[SEXO_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [TIPO_PAGOS](
	[TIPO_PAGO_ID] [int] NOT NULL,
	[TIPO_PAGO_NOMB] [nvarchar](50) NOT NULL,
	[TIPO_PAGO_DESC] [nvarchar](max) NOT NULL,
 CONSTRAINT [PK_TIPO_PAGOS] PRIMARY KEY CLUSTERED 
(
	[TIPO_PAGO_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
INSERT [ALUMNO] ([ALUM_ID], [ALUM_NOMB], [ALUM_APAT], [ALUM_AMAT], [ALUM_FNAC], [ALUM_SEXO_ID], [ALUM_FREG], [ALLUM_MAIL], [ALUM_PRGR], [ALUM_MATR], [ALUM_EXPS_ID], [ALUM_ETAP_ID], [ALUM_PERF_ID], [ALUM_PASS]) VALUES (1, N'Gabriel', N'Gutierrez', N'Echeverria', CAST(0x400B0B00 AS Date), 1, CAST(0x2B3B0B00 AS Date), N'gabo_gutierrez@outlook.com', CAST(9.30 AS Decimal(5, 2)), N'GUEG2016', 1, 2, 1, N'12345')
GO
INSERT [ETAPAS] ([ETAP_ID], [ETAP_NOMB], [ETAP_DESC]) VALUES (1, N'Registro', N'Registro de datos del alumno.')
GO
INSERT [ETAPAS] ([ETAP_ID], [ETAP_NOMB], [ETAP_DESC]) VALUES (2, N'Examen Psicométrico', N'Evaluación mediante examen psicométrico.')
GO
INSERT [ETAPAS] ([ETAP_ID], [ETAP_NOMB], [ETAP_DESC]) VALUES (3, N'Recabar Documentos', N'Solicitar y recabar documentos del alumno.')
GO
INSERT [ETAPAS] ([ETAP_ID], [ETAP_NOMB], [ETAP_DESC]) VALUES (4, N'Pagos', N'Pagos de colegiaturas, inscripción y varios.')
GO
INSERT [ETAPAS] ([ETAP_ID], [ETAP_NOMB], [ETAP_DESC]) VALUES (5, N'Examen ', N'Aplicación de examen general de conocimientos del alumno.')
GO
INSERT [ETAPAS] ([ETAP_ID], [ETAP_NOMB], [ETAP_DESC]) VALUES (6, N'Cierre', N'Cierre del registro del alumno.')
GO
INSERT [EXAMEN_PSICOMETRICO] ([EXPS_ID], [EXPS_RESP_UNO], [EXPS_RESP_DOS], [EXPS_RESP_TRES], [EXPS_RESP_CUAT], [EXPS_FECH_APLI], [EXPS_ESTA]) VALUES (1, 1, 0, 1, 0, CAST(0x2B3B0B00 AS Date), 1)
GO
INSERT [PERFIL] ([PERF_ID], [PERF_NOMB]) VALUES (1, N'Alumno')
GO
INSERT [PERFIL] ([PERF_ID], [PERF_NOMB]) VALUES (2, N'Administrativo')
GO
INSERT [SEXO] ([SEXO_ID], [SEXO_NOMB]) VALUES (1, N'Masculino')
GO
INSERT [SEXO] ([SEXO_ID], [SEXO_NOMB]) VALUES (2, N'Femenino')
GO
INSERT [TIPO_PAGOS] ([TIPO_PAGO_ID], [TIPO_PAGO_NOMB], [TIPO_PAGO_DESC]) VALUES (1, N'Efectivo', N'Dinero contante y sonante')
GO
INSERT [TIPO_PAGOS] ([TIPO_PAGO_ID], [TIPO_PAGO_NOMB], [TIPO_PAGO_DESC]) VALUES (2, N'Tarjeta Visa', N'')
GO
INSERT [TIPO_PAGOS] ([TIPO_PAGO_ID], [TIPO_PAGO_NOMB], [TIPO_PAGO_DESC]) VALUES (3, N'Tarjeta MasterCard', N'')
GO
INSERT [TIPO_PAGOS] ([TIPO_PAGO_ID], [TIPO_PAGO_NOMB], [TIPO_PAGO_DESC]) VALUES (4, N'Tarjeta American Express', N'')
GO
INSERT [TIPO_PAGOS] ([TIPO_PAGO_ID], [TIPO_PAGO_NOMB], [TIPO_PAGO_DESC]) VALUES (5, N'Transferencia Electrónica', N'')
GO
ALTER TABLE [ALUMNO]  WITH CHECK ADD  CONSTRAINT [FK_ALUMNO_ETAPAS] FOREIGN KEY([ALUM_ETAP_ID])
REFERENCES [ETAPAS] ([ETAP_ID])
GO
ALTER TABLE [ALUMNO] CHECK CONSTRAINT [FK_ALUMNO_ETAPAS]
GO
ALTER TABLE [ALUMNO]  WITH CHECK ADD  CONSTRAINT [FK_ALUMNO_EXAMEN_PSICOMETRICO] FOREIGN KEY([ALUM_EXPS_ID])
REFERENCES [EXAMEN_PSICOMETRICO] ([EXPS_ID])
GO
ALTER TABLE [ALUMNO] CHECK CONSTRAINT [FK_ALUMNO_EXAMEN_PSICOMETRICO]
GO
ALTER TABLE [ALUMNO]  WITH CHECK ADD  CONSTRAINT [FK_ALUMNO_PERFIL] FOREIGN KEY([ALUM_PERF_ID])
REFERENCES [PERFIL] ([PERF_ID])
GO
ALTER TABLE [ALUMNO] CHECK CONSTRAINT [FK_ALUMNO_PERFIL]
GO
ALTER TABLE [ALUMNO]  WITH CHECK ADD  CONSTRAINT [FK_ALUMNO_SEXO] FOREIGN KEY([ALUM_SEXO_ID])
REFERENCES [SEXO] ([SEXO_ID])
GO
ALTER TABLE [ALUMNO] CHECK CONSTRAINT [FK_ALUMNO_SEXO]
GO
ALTER TABLE [DOCUMENTOS]  WITH CHECK ADD  CONSTRAINT [FK_DOCUMENTOS_ALUMNO] FOREIGN KEY([DOCS_ALUM_ID])
REFERENCES [ALUMNO] ([ALUM_ID])
GO
ALTER TABLE [DOCUMENTOS] CHECK CONSTRAINT [FK_DOCUMENTOS_ALUMNO]
GO
ALTER TABLE [EXAMEN]  WITH CHECK ADD  CONSTRAINT [FK_EXAMEN_ALUMNO] FOREIGN KEY([EXAM_ALUM_ID])
REFERENCES [ALUMNO] ([ALUM_ID])
GO
ALTER TABLE [EXAMEN] CHECK CONSTRAINT [FK_EXAMEN_ALUMNO]
GO
ALTER TABLE [PAGOS]  WITH CHECK ADD  CONSTRAINT [FK_PAGOS_ALUMNO] FOREIGN KEY([PAGO_ALUM_ID])
REFERENCES [ALUMNO] ([ALUM_ID])
GO
ALTER TABLE [PAGOS] CHECK CONSTRAINT [FK_PAGOS_ALUMNO]
GO
ALTER TABLE [PAGOS]  WITH CHECK ADD  CONSTRAINT [FK_PAGOS_TIPO_PAGOS] FOREIGN KEY([PAGO_TIPO_PAGO_ID])
REFERENCES [TIPO_PAGOS] ([TIPO_PAGO_ID])
GO
ALTER TABLE [PAGOS] CHECK CONSTRAINT [FK_PAGOS_TIPO_PAGOS]
GO
ALTER DATABASE [Escuela] SET  READ_WRITE 
GO
